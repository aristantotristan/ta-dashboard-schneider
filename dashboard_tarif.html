<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Monitoring Tarif Mesin</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f1f1f1;
        margin: 0;
        padding: 0;
    }
    .container {
        max-width: 800px;
        margin: 40px auto;
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    h2 {
        text-align: center;
        margin-bottom: 20px;
    }

    .block {
        padding: 15px;
        background: #fafafa;
        border-radius: 8px;
        margin-bottom: 12px;
        border-left: 5px solid #007bff;
    }
    .label {
        font-weight: bold;
        color: #333;
    }
</style>
</head>
<body>

<div class="container">
    <h2>Monitoring Tarif Mesin 1</h2>

    <div class="block">
        <div class="label">Watt (W):</div>
        <div id="watt">...</div>
    </div>

    <div class="block">
        <div class="label">Energi (kWh):</div>
        <div id="kwh">...</div>
    </div>

    <div class="block">
        <div class="label">Tarif/kWh (Rp):</div>
        <div id="tarif">...</div>
    </div>

    <div class="block">
        <div class="label">Total Biaya (Rp):</div>
        <div id="biaya">...</div>
    </div>

    <div class="block">
        <div class="label">Waktu Update:</div>
        <div id="waktu">...</div>
    </div>

</div>

<script>
const SUPABASE_URL = "https://rojhcadtqfynlqzubftx.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJvamhjYWR0cWZ5bmxxenViZnR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMzYzNTksImV4cCI6MjA3NzcxMjM1OX0.XZElBWD-QdS8XVKex92VKUAlifC6BXqe3kGYPmZ1Mcs";

// GET DATA TERAKHIR DARI SUPABASE
async function loadData() {
    try {
        const res = await fetch(`${SUPABASE_URL}/rest/v1/tarif_log?select=*&order=id.desc&limit=1`, {
            headers: {
                "apikey": SUPABASE_KEY,
                "Authorization": "Bearer " + SUPABASE_KEY
            }
        });

        const data = await res.json();

        if (data.length === 0) return;

        let d = data[0];

        document.getElementById("watt").innerText = d.watt + " W";
        document.getElementById("kwh").innerText = d.kwh.toFixed(4) + " kWh";
        document.getElementById("tarif").innerText = "Rp " + d.tarif_perkwh;
        document.getElementById("biaya").innerText = "Rp " + d.biaya.toLocaleString();
        document.getElementById("waktu").innerText = d.created_at.replace("T", " ").substring(0, 19);

    } catch (e) {
        console.log("Error:", e);
    }
}

// Auto refresh tiap 3 detik
setInterval(loadData, 3000);
loadData();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - TA Monitoring</title>
    <!-- 1. Impor Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f4f7f6; }
        .login-container { 
            background: white; 
            padding: 40px; 
            border-radius: 12px; 
            box-shadow: 0 6px 18px rgba(0,0,0,0.07); 
            width: 100%; 
            max-width: 400px; 
            text-align: center; 
        }
        
        /* Header (Hanya Logo + "Login Dashboard") */
        .header-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 25px; /* Disesuaikan */
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .logo {
            width: 80px; 
            height: auto;
            margin-right: 15px;
        }

        /* ðŸ”¥ PERUBAHAN: Judul "Login Dashboard" dipindah ke header dan diperbesar */
        h2 { 
            color: #00529B; 
            margin: 0; /* Hapus margin default */
            font-size: 1.8em; /* ðŸ”¥ Diperbesar lagi dari 1.5em */
            font-weight: bold; /* Ditebalkan */
            text-align: left;
        }
        
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #444; }
        .form-group input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; } /* Fix padding */
        
        .login-btn { width: 100%; padding: 12px; background-color: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; font-weight: 600; }
        .login-btn:hover { background-color: #0056b3; }
        
        .error-msg { color: #dc3545; background-color: #f8d7da; border: 1px solid #f5c6cb; padding: 10px; border-radius: 8px; margin-bottom: 20px; display: none; }
        .bottom-link { margin-top: 20px; font-size: 0.9em; }
    </style>
</head>
<body>

    <div class="login-container">

        <!-- Header (Logo + Judul "Login Dashboard") -->
        <div class="header-container">
            <img src="https://amarilyskg.co.id/template/images/logo_AKG.png" alt="Logo PT. AKG" class="logo">
            <!-- Tulisan "PT" dihapus, "Login Dashboard" dipindah ke sini -->
            <h2>Login Dashboard</h2>
        </div>

        <!-- (Sub-Judul h2 dipindah ke atas) -->

        <div id="errorMessage" class="error-msg"></div>

        <form id="loginForm">
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" placeholder="email@anda.com" required>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
            </div>
            <button type="submit" class="login-btn" id="loginButton">Login</button>
        </form>

        <p class="bottom-link">Belum punya akun? <a href="signup.html">Daftar di sini</a></p>
    </div>

    <script type="module">
        // --- FASE 1: KONFIGURASI SUPABASE (WAJIB DIISI) ---
        const SUPABASE_URL = 'https://rojhcadtqfynlqzubftx.supabase.co'; // Ganti ini
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJvamhjYWR0cWZ5bmxxenViZnR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMzYzNTksImV4cCI6MjA3NzcxMjM1OX0.XZElBWD-QdS8XVKex92VKUAlifC6BXqe3kGYPmZ1Mcs'; // Ganti ini (Anon, Public Key)
        
        // --- Variabel Global ---
        let supabase;
        const loginForm = document.getElementById('loginForm');
        const loginButton = document.getElementById('loginButton');
        const errorMessage = document.getElementById('errorMessage');

        // --- FASE 2: Inisialisasi Klien Supabase ---
        try {
            // ðŸ”¥ PERBAIKAN: Menggunakan window.supabase (Penting untuk Vercel/CDN)
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        } catch (error) {
            console.error("Gagal inisialisasi Supabase. Cek URL/Key.", error);
            errorMessage.textContent = "Error Konfigurasi Supabase. Cek Konsol (F12).";
            errorMessage.style.display = 'block';
        }

        // --- FASE 3: Event Listener untuk Login ---
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // Mencegah form submit default

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            // Reset pesan
            errorMessage.style.display = 'none';
            loginButton.disabled = true;
            loginButton.textContent = 'Memproses...';

            // Coba login
            const { data, error } = await supabase.auth.signInWithPassword({
                email: email,
                password: password,
            });

            if (error) {
                console.error("Error saat Login:", error);
                if (error.message.includes("Invalid login credentials")) {
                    errorMessage.textContent = "Email atau Password salah.";
                } else if (error.message.includes("Email not confirmed")) {
                    errorMessage.textContent = "Email Anda belum diverifikasi. Silakan cek email (termasuk folder Spam).";
                } else {
                    errorMessage.textContent = error.message;
                }
                errorMessage.style.display = 'block';
            } else {
                console.log("Login berhasil:", data);
                // Jika login sukses, lempar ke halaman Menu Utama (index.html)
                window.location.href = 'index.html';
            }
            
            loginButton.disabled = false;
            loginButton.textContent = 'Login';
        });

        // --- FASE 4: Cek Sesi (Jika sudah login, lempar ke index) ---
        (async () => {
            if (supabase) { // Hanya jalankan jika supabase berhasil diinisialisasi
                const { data: { session } } = await supabase.auth.getSession();
                if (session) {
                    // Jika sudah ada sesi aktif, langsung lempar ke dashboard
                    window.location.href = 'index.html';
                }
            }
        })();

    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Master Power Meter • Analisis Konsumsi</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=JetBrains+Mono:wght@500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#000000; --card:#0f0f0f; --glow:#00e5bd; --accent:#00e5bd; --text:#e0f2fe; --muted:#8b949e; --border:#1a1a1a;
      --lwbp:#0f766e; --wbp:#991b1b; --total:#0f4c3a;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:var(--bg);color:var(--text);font-family:'JetBrains Mono',monospace;min-height:100vh;
      background-image:radial-gradient(circle at 10% 20%,rgba(0,229,189,0.08) 0%,transparent 40%),
                       radial-gradient(circle at 90% 80%,rgba(0,229,189,0.06) 0%,transparent 40%);}
    header{text-align:center;padding:4rem 1rem 3rem;}
    h1{font-family:'Orbitron',sans-serif;font-size:4.5rem;font-weight:900;
       background:linear-gradient(135deg,#00e5bd,#00ffea,#00e5bd);-webkit-background-clip:text;background-clip:text;
       -webkit-text-fill-color:transparent;text-shadow:0 0 50px rgba(0,229,189,0.7);letter-spacing:3px;}
    .subtitle{color:var(--muted);font-size:1.2rem;margin-top:1rem;letter-spacing:4px;text-transform:uppercase;opacity:0.9;}
    
    #cardsContainer{display:grid;grid-template-columns:repeat(6,1fr);gap:2.2rem;max-width:1750px;margin:0 auto;padding:2rem 5rem;}
    .machine-card{background:var(--card);border:1px solid var(--border);border-radius:22px;padding:2.4rem 1rem;text-align:center;
      cursor:pointer;position:relative;overflow:hidden;transition:all .6s cubic-bezier(0.23,1,0.32,1);box-shadow:0 12px 40px rgba(0,0,0,0.6);}
    .machine-card::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:0;height:5px;
      background:var(--glow);box-shadow:0 0 30px var(--glow);transition:all .6s;}
    .machine-card:hover{transform:translateY(-24px) scale(1.08);border-color:var(--glow);box-shadow:0 40px 100px rgba(0,229,189,0.4);}
    .machine-card:hover::before{width:120%}
    .card-title{font-size:1.38rem;font-weight:700;color:var(--text);margin-bottom:0.8rem;}
    .sid-label{font-family:'Orbitron',sans-serif;font-size:1.5rem;font-weight:800;color:var(--glow);letter-spacing:2px;text-shadow:0 0 25px var(--glow);}

    #analysisPanel{display:none;position:fixed;inset:0;background:#000000ee;backdrop-filter:blur(20px);z-index:9999;padding:2rem;overflow-y:auto;}
    .popup-card{background:var(--card);border:1px solid var(--border);border-radius:28px;max-width:1100px;margin:2rem auto;overflow:hidden;
      box-shadow:0 40px 120px rgba(0,0,0,0.8);}
    .popup-header{background:linear-gradient(135deg,#00e5bd,#00ffcc);padding:2.5rem;text-align:center;color:#000;
      font-family:'Orbitron',sans-serif;font-size:2.4rem;font-weight:900;letter-spacing:2px;}

    .back-btn{position:absolute;top:1.8rem;left:1.8rem;background:#000;color:var(--glow);border:2px solid var(--glow);
      padding:14px 28px;border-radius:50px;font-weight:800;cursor:pointer;transition:all .4s;box-shadow:0 0 40px rgba(0,229,189,0.5);}
    .back-btn:hover{background:var(--glow);color:#000;transform:scale(1.12);}

    .table-container{margin:2rem;border-radius:20px;overflow:hidden;box-shadow:0 30px 80px rgba(0,0,0,0.7)}
    table{width:100%;border-collapse:collapse;background:var(--card)}
    th{background:#111;color:var(--glow);padding:1.6rem;font-weight:800;text-transform:uppercase;letter-spacing:2px;font-size:0.95rem;}
    td{padding:1.6rem;text-align:center;font-size:1.2rem;font-weight:700;}
    .status{text-align:center;padding:2rem;font-size:1.4rem;color:var(--glow);text-shadow:0 0 30px var(--glow);font-weight:600;}
  </style>
</head>
<body>

  <div id="mainMenu">
    <header>
      <h1>MASTER POWER METER</h1>
      <p class="subtitle">Pilih Mesin • Analisis Konsumsi & Biaya</p>
    </header>
    <div id="cardsContainer"></div>
  </div>

  <div id="analysisPanel">
    <div class="popup-card">
      <div class="popup-header" id="selectedMachine">
        <button class="back-btn" onclick="backToMenu()">BACK</button>
      </div>

      <div class="status" id="status">Memuat data...</div>

      <div class="table-container">
        <table>
          <thead>
            <tr><th>LWBP (kWh)</th><th>WBP (kWh)</th><th>Total (kWh)</th></tr>
          </thead>
          <tbody>
            <tr>
              <td id="lwbpVal">-</td>
              <td id="wbpVal">-</td>
              <td id="totalVal">-</td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
  </div>

<script>
const TAGS = {
  1:'UNKNOW',2:'UNKNOW',3:'POMPA MC 12',4:'MC 9',5:'UNKNOW',6:'MC 40',7:'MC 39',8:'MC 6',
  9:'HEATER MC 5',10:'POMPA MC 5',11:'UNKNOW',12:'MC 34',13:'MC 35',14:'UNKNOW',15:'UNKNOW',
  16:'MC 38',17:'MC 36',18:'MC 37'
};

const supabase = window.supabase.createClient(
  "https://rojhcadtqfynlqzubftx.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJvamhjYWR0cWZ5bmxxenViZnR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMzYzNTksImV4cCI6MjA3NzcxMjM1OX0.XZElBWD-QdS8XVKex92VKUAlifC6BXqe3kGYPmZ1Mcs"
);

function createCards(){
  const container=document.getElementById("cardsContainer");
  for(let i=1;i<=18;i++){
    const div=document.createElement("div");
    div.className="machine-card";
    div.onclick=()=>openMachine(i);
    div.innerHTML=`<div class="card-title">${TAGS[i]}</div><div class="sid-label">SID ${i}</div>`;
    container.appendChild(div);
  }
}

async function openMachine(id){
  selected=id;
  document.getElementById("mainMenu").style.display="none";
  document.getElementById("analysisPanel").style.display="block";
  document.getElementById("selectedMachine").innerHTML=
    `<button class="back-btn" onclick="backToMenu()">BACK</button> Analisis Konsumsi • ${TAGS[id]} <small>• SID ${id}</small>`;

  loadFinishData(id);
}

function backToMenu(){
  document.getElementById("analysisPanel").style.display="none";
  document.getElementById("mainMenu").style.display="block";
}

async function loadFinishData(id){
  document.getElementById("status").textContent="Mengambil data finish_lwbp / finish_wbp...";

  const { data:lwbp } = await supabase.from("finish_lwbp").select("*").eq("sid_mesin", id).single();
  const { data:wbp  } = await supabase.from("finish_wbp").select("*").eq("sid_mesin", id).single();

  const l = lwbp?.total_lwbp ?? 0;
  const w = wbp?.total_wbp ?? 0;

  document.getElementById("lwbpVal").textContent = l.toFixed(2);
  document.getElementById("wbpVal").textContent  = w.toFixed(2);
  document.getElementById("totalVal").textContent= (l+w).toFixed(2);

  document.getElementById("status").textContent = "Success!";
}

createCards();
</script>
</body>
</html>

import { useState } from "react";
import { createClient } from "@supabase/supabase-js";

const supabase = createClient(
  "https://rojhcadtqfynlqzubftx.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJvamhjYWR0cWZ5bmxxenViZnR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMzYzNTksImV4cCI6MjA3NzcxMjM1OX0.XZElBWD-QdS8XVKex92VKUAlifC6BXqe3kGYPmZ1Mcs"
);

export default function DailyReport() {
  const [startDate, setStartDate] = useState("");
  const [endDate, setEndDate] = useState("");
  const [rows, setRows] = useState([]);
  const [message, setMessage] = useState("");

  const loadData = async () => {
    const { data, error } = await supabase
      .from("daily_meter_summary")
      .select("tgl, sid_mesin, lwbp_total, wbp_total")
      .gte("tgl", startDate)
      .lte("tgl", endDate)
      .order("tgl", { ascending: true })
      .order("sid_mesin", { ascending: true });

    if (error) {
      setMessage(`❌ Error: ${error.message}`);
      return;
    }

    setRows(data);
    setMessage(`Sukses! ${data.length} baris ditemukan`);
  };

  return (
    <div style={styles.container}>
      <button style={styles.backButton}>BACK</button>

      <h1 style={styles.title}>Analisis Konsumsi • MC 37</h1>

      <div style={styles.inputSection}>
        <label>Tanggal Awal</label>
        <input type="date" value={startDate} onChange={(e) => setStartDate(e.target.value)} />

        <label>Tanggal Akhir</label>
        <input type="date" value={endDate} onChange={(e) => setEndDate(e.target.value)} />

        <button style={styles.loadButton} onClick={loadData}>
          LOAD DATA
        </button>
      </div>

      <p style={styles.status}>{message}</p>

      <table style={styles.table}>
        <thead>
          <tr>
            <th>Tanggal</th>
            <th>SID</th>
            <th>LWBP (kWh)</th>
            <th>WBP (kWh)</th>
          </tr>
        </thead>
        <tbody>
          {rows.map((r, index) => (
            <tr key={index}>
              <td>{r.tgl}</td>
              <td>{r.sid_mesin}</td>
              <td>{Number(r.lwbp_total).toFixed(2)}</td>
              <td>{Number(r.wbp_total).toFixed(2)}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}

const styles = {
  container: {
    padding: "40px",
    minHeight: "100vh",
    background: "#000000",
    color: "#00FFC2",
    fontFamily: "monospace",
  },
  backButton: {
    padding: "10px 18px",
    borderRadius: "40px",
    background: "#00FFC2",
    color: "#000",
    fontWeight: "bold",
    cursor: "pointer",
    marginBottom: "10px",
  },
  title: {
    textAlign: "center",
    background: "#07FFD6",
    color: "#000",
    padding: "15px",
    borderRadius: "15px",
    fontSize: "36px",
    marginBottom: "25px",
  },
  inputSection: {
    display: "flex",
    gap: "12px",
    marginBottom: "25px",
    alignItems: "center",
  },
  loadButton: {
    padding: "10px 15px",
    background: "#00FFC2",
    color: "#000",
    fontWeight: "bold",
    cursor: "pointer",
    borderRadius: "8px",
  },
  status: {
    fontSize: "18px",
    textAlign: "center",
    marginBottom: "15px",
  },
  table: {
    width: "100%",
    borderCollapse: "collapse",
    textAlign: "center",
    fontSize: "20px",
  },
  row: {
    borderBottom: "1px solid #333",
  },
};

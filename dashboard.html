<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Dashboard (3-Phase)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Paste CSS dashboard sebelumnya disini agar tidak kepanjangan */
        /* Intinya CSS Dark Mode, Grid, Card, dll */
        :root { --bg-body: #f0f2f5; --bg-card: #ffffff; --text-main: #333333; --text-sub: #546e7a; --text-value: #0d47a1; --border-card: #e0e0e0; --accent: #1a237e; --shadow: rgba(0, 0, 0, 0.07); --nav-bg: #ffffff; }
        [data-theme="dark"] { --bg-body: #121212; --bg-card: #1e1e1e; --text-main: #e0e0e0; --text-sub: #b0bec5; --text-value: #64b5f6; --border-card: #333333; --accent: #82b1ff; --shadow: rgba(0, 0, 0, 0.5); --nav-bg: #2c2c2c; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: var(--bg-body); color: var(--text-main); margin: 0; padding: 25px; padding-top: 70px; transition: 0.3s; }
        /* ... (Lanjutkan CSS lainnya) ... */
    </style>
</head>
<body>
    <div id="status" class="bg-wait">Menghubungkan...</div>
    <script>
// CONFIG SUPABASE & MQTT SAMA
const SUPABASE_URL = "https://khevzqqtswbdatbkkmme.supabase.co"; 
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtoZXZ6cXF0c3diZGF0YmtrbW1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1MTY4MDgsImV4cCI6MjA3OTA5MjgwOH0.N28mnbk8tTAJkm47DS2pzvsHHChlyCovT6vi2Z4aqHc";
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const MQTT_HOST = "701d32236feb43b38c22855a611f4d42.s1.eu.hivemq.cloud";
const MQTT_PORT = 8884;
const MQTT_USER = "web_dashboard";
const MQTT_PASS = "Tristan12";
const MQTT_TOPIC_DATA = "politeknik/meter/data";
const WATCHDOG_TIMEOUT = 180000; 

// ... (VARIABLE DAN FUNGSI LAIN SAMA) ...

// FUNGSI UPDATE NILAI (PENTING: Sesuai JSON v51)
function setMeterOnline(d) {
    // ENERGI
    document.getElementById('val-total-ea').textContent = fmt(d.e, 2); 
    document.getElementById('val-total-er').textContent = fmt(d.q_tot, 2);
    document.getElementById('val-part-e').textContent = fmt(d.e_part, 2); 
    document.getElementById('val-part-r').textContent = fmt(d.q_part, 2);
    
    // LISTRIK
    document.getElementById('val-v').textContent = fmt(d.v, 1);
    document.getElementById('val-i').textContent = fmt(d.i, 2); // Avg
    
    // 3 FASA
    document.getElementById('val-i1').textContent = fmt(d.i1, 1);
    document.getElementById('val-i2').textContent = fmt(d.i2, 1);
    document.getElementById('val-i3').textContent = fmt(d.i3, 1);

    document.getElementById('val-p').textContent = fmt(d.p, 0);
    document.getElementById('val-q').textContent = fmt(d.q, 0); 
    document.getElementById('val-s').textContent = fmt(d.s, 0); // kVA -> VA
    document.getElementById('val-pf').textContent = fmt(d.pf, 3); 
    document.getElementById('val-hz').textContent = fmt(d.hz, 1);
    
    // OPSI WAKTU
    document.getElementById(`val-op-days`).textContent = Math.floor(d.op_time / 24); 
    document.getElementById(`val-op-hrs`).textContent = (d.op_time % 24).toFixed(1);
}

// ... (SISA LOGIKA MQTT DAN WATCHDOG SAMA PERSIS SEPERTI SEBELUMNYA) ...
</script>
</body>
</html>

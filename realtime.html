<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Realtime Meter Dashboard</title>
    <meta http-equiv="refresh" content="180"> <!-- fallback refresh setiap 3 menit jika freeze -->
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0d1117;
            color: #fff;
            text-align: center;
            padding: 20px;
        }
        .card {
            background: #161b22;
            border-radius: 12px;
            padding: 20px;
            margin: 10px auto;
            width: 320px;
            box-shadow: 0 0 12px #000;
        }
        .value {
            font-size: 42px;
            margin-top: 10px;
        }
        .label {
            font-size: 18px;
            opacity: .7;
        }
    </style>
</head>
<body>

    <h1>Realtime Meter Data</h1>
    <p>Source: Supabase Watchdog (24/7 backend, no browser required)</p>

    <div class="card">
        <div class="label">Tegangan</div>
        <div id="tegangan" class="value">--</div>
    </div>

    <div class="card">
        <div class="label">Arus</div>
        <div id="arus" class="value">--</div>
    </div>

    <div class="card">
        <div class="label">Daya</div>
        <div id="daya" class="value">--</div>
    </div>

    <div class="card">
        <div class="label">Energi</div>
        <div id="energi" class="value">--</div>
    </div>

    <div class="card">
        <div class="label">Frekuensi</div>
        <div id="frekuensi" class="value">--</div>
    </div>

    <script>
        async function loadData() {
            try {
                const response = await fetch(
                    "https://rojhcadtqfynlqzubftx.supabase.co/functions/v1/watchdog-offline",
                    { method: "GET" }
                );

                const data = await response.json();

                // --- pastikan backend kirim JSON begini ---
                // {
                //   "tegangan": 220,
                //   "arus": 4.2,
                //   "daya": 930,
                //   "energi": 12.3,
                //   "frekuensi": 50
                // }

                document.getElementById("tegangan").innerHTML = data.tegangan + " V";
                document.getElementById("arus").innerHTML = data.arus + " A";
                document.getElementById("daya").innerHTML = data.daya + " W";
                document.getElementById("energi").innerHTML = data.energi + " kWh";
                document.getElementById("frekuensi").innerHTML = data.frekuensi + " Hz";
            }
            catch (e) {
                console.log("Gagal load:", e);
            }
        }

        // realtime update tiap 3 detik
        setInterval(loadData, 3000);
        loadData();
    </script>

</body>
</html>

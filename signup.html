<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar Akun - TA Monitoring</title>
    <!-- 1. Impor Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f4f7f6; }
        .login-container { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.07); width: 100%; max-width: 400px; text-align: center; }
        h2 { color: #333; margin-bottom: 20px; }
        p { color: #666; margin-bottom: 25px; font-size: 0.9em; }
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #444; }
        .form-group input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; } /* Fix padding */
        .login-btn { width: 100%; padding: 12px; background-color: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; font-weight: 600; }
        .login-btn:hover { background-color: #0056b3; }
        .error-msg { color: #dc3545; background-color: #f8d7da; border: 1px solid #f5c6cb; padding: 10px; border-radius: 8px; margin-bottom: 20px; display: none; }
        .success-msg { color: #155724; background-color: #d4edda; border: 1px solid #c3e6cb; padding: 10px; border-radius: 8px; margin-bottom: 20px; display: none; }
        .bottom-link { margin-top: 20px; font-size: 0.9em; }
    </style>
</head>
<body>

    <div class="login-container">
        <h2>Daftar Akun Baru</h2>
        <p>Semua akun baru akan didaftarkan sebagai 'Pending' (Menunggu Persetujuan Admin).</p>

        <div id="errorMessage" class="error-msg"></div>
        <div id="successMessage" class="success-msg"></div>

        <form id="signupForm">
            <!-- Form 'Nama Lengkap' (Sesuai v2) -->
            <div class="form-group">
                <label for="fullName">Nama Lengkap</label>
                <input type="text" id="fullName" placeholder="Masukkan nama lengkap Anda" required>
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" placeholder="email@anda.com" required>
            </div>
            <div class="form-group">
                <label for="password">Password (Min. 6 karakter)</label>
                <input type="password" id="password" placeholder="••••••••" required>
            </div>
            <button type="submit" class="login-btn" id="signupButton">Daftar</button>
        </form>

        <p class="bottom-link">Sudah punya akun? <a href="login.html">Login di sini</a></p>
    </div>

    <script type="module">
        // --- FASE 1: KONFIGURASI SUPABASE (WAJIB DIISI) ---
        const SUPABASE_URL = 'https://rojhcadtqfynlqzubftx.supabase.co'; // Ganti ini
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJvamhjYWR0cWZ5bmxxenViZnR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMzYzNTksImV4cCI6MjA3NzcxMjM1OX0.XZElBWD-QdS8XVKex92VKUAlifC6BXqe3kGYPmZ1Mcs'; // Ganti ini (Anon, Public Key)
        
        // --- Variabel Global ---
        let supabase;
        const signupForm = document.getElementById('signupForm');
        const signupButton = document.getElementById('signupButton');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');

        // --- FASE 2: Inisialisasi Klien Supabase ---
        try {
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        } catch (error) {
            console.error("Gagal inisialisasi Supabase. Cek URL/Key.", error);
            errorMessage.textContent = "Error Konfigurasi Supabase. Cek Konsol (F12).";
            errorMessage.style.display = 'block';
        }

        // --- FASE 3: Event Listener untuk Pendaftaran ---
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // Mencegah form submit default

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const fullName = document.getElementById('fullName').value; // Ambil Nama Lengkap

            // Reset pesan
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            signupButton.disabled = true;
            signupButton.textContent = 'Mendaftarkan...';

            // Kirim 'full_name' di dalam options.data
            // Ini akan dibaca oleh trigger 'handle_new_user' (v4) di Supabase
            const { data, error } = await supabase.auth.signUp({
                email: email,
                password: password,
                options: {
                    data: {
                        full_name: fullName 
                    }
                }
            });

            if (error) {
                console.error("Error saat Sign Up:", error);
                errorMessage.textContent = error.message;
                errorMessage.style.display = 'block';
            } else {
                console.log("Pendaftaran berhasil:", data);
                // Tampilkan pesan sukses dan minta cek email
                successMessage.textContent = "Pendaftaran berhasil! Silakan cek email Anda (termasuk folder Spam) untuk link verifikasi.";
                successMessage.style.display = 'block';
                signupForm.reset();
            }
            
            signupButton.disabled = false;
            signupButton.textContent = 'Daftar';
        });

    </script>
</body>
</html>


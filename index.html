<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Monitoring Energi</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* CSS (Sama seperti sebelumnya) */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #1a237e; /* Biru tua */
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .card {
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }
        .card h3 {
            margin-top: 0;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            color: #004d40; /* Hijau tua */
        }
        .data-point {
            margin-bottom: 15px;
        }
        .data-point label {
            display: block;
            font-size: 0.95em;
            color: #555;
            margin-bottom: 5px;
        }
        .data-point .value {
            font-size: 2.3em;
            font-weight: 600;
            color: #0d47a1; /* Biru */
        }
        .data-point .unit {
            font-size: 1.1em;
            color: #444;
            margin-left: 8px;
        }
        /* Tata letak khusus untuk P,Q,S */
        .power-group {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            text-align: center;
        }
        .power-group .data-point {
            flex: 1;
        }
        .power-group .value {
            font-size: 1.8em;
        }
        /* Kartu yang lebih lebar */
        .card.wide {
            grid-column: span 2; 
        }
        /* Style untuk chart canvas */
        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
        }

        /* Fallback untuk layar kecil */
        @media (max-width: 980px) {
            .card.wide {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Dashboard Monitoring Energi Schneider</h1>
        
        <div class="dashboard-grid">

            <div class="card wide">
                <h3>Tren Daya (Power)</h3>
                <div class="chart-container">
                    <canvas id="powerTrendChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3>Total Energi</h3>
                <div class="data-point">
                    <label>Total EA Import (Active)</label>
                    <div>
                        <span class="value" id="total-ea">0.00</span>
                        <span class="unit">kWh</span>
                    </div>
                </div>
                <div class="data-point">
                    <label>Total ER Import (Reactive)</label>
                    <div>
                        <span class="value" id="total-er">0.00</span>
                        <span class="unit">kVARh</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Energi Parsial</h3>
                <div class="data-point">
                    <label>Partial Active E</label>
                    <div>
                        <span class="value" id="partial-active">0.00</span>
                        <span class="unit">kWh</span>
                    </div>
                </div>
                <div class="data-point">
                    <label>Partial Reactive E</label>
                    <div>
                        <span class="value" id="partial-reactive">0.00</span>
                        <span class="unit">kVARh</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Tegangan & Arus</h3>
                <div class="data-point">
                    <label>Voltage</label>
                    <div>
                        <span class="value" id="voltage">0.0</span>
                        <span class="unit">V</span>
                    </div>
                </div>
                <div class="data-point">
                    <label>Current</label>
                    <div>
                        <span class="value" id="current">0.00</span>
                        <span class="unit">A</span>
                    </div>
                </div>
            </div>

            <div class="card wide">
                <h3>Daya (Power) - Nilai Saat Ini</h3>
                <div class="power-group">
                    <div class="data-point">
                        <label>Active Power (P)</label>
                        <div>
                            <span class="value" id="power-p">0</span>
                            <span class="unit">W</span>
                        </div>
                    </div>
                    <div class="data-point">
                        <label>Reactive Power (Q)</label>
                        <div>
                            <span class="value" id="power-q">0</span>
                            <span class="unit">VAR</span>
                        </div>
                    </div>
                    <div class="data-point">
                        <label>Apparent Power (S)</label>
                        <div>
                            <span class="value" id="power-s">0.00</span>
                            <span class="unit">kVA</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Faktor Daya & Frekuensi</h3>
                <div class="data-point">
                    <label>Power Factor (PF)</label>
                    <div>
                        <span class="value" id="pf">0.00</span>
                        <span class="unit"></span>
                    </div>
                </div>
                <div class="data-point">
                    <label>Frequency (F)</label>
                    <div>
                        <span class="value" id="freq">0.0</span>
                        <span class="unit">Hz</span>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>Waktu Operasi</h3>
                <div class="data-point">
                    <label>Hari</label>
                    <div>
                        <span class="value" id="op-days">0</span>
                        <span class="unit">Days</span>
                    </div>
                </div>
                <div class="data-point">
                    <label>Jam</label>
                    <div>
                        <span class="value" id="op-hrs">0</span>
                        <span class="unit">Hrs</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Tariffs</h3>
                <div class="data-point">
                    <label>Status</label>
                    <div>
                        <span class="value" id="tariffs">-</span>
                        <span class="unit"></span>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // 3. TAMBAHKAN JAVASCRIPT UNTUK CHART
        
        // Variabel global untuk menyimpan instance chart
        let myPowerChart; 
        const MAX_DATA_POINTS = 20; // Jumlah data di chart (20 data * 3 detik = 1 menit)

        /**
         * Fungsi untuk inisialisasi chart (dijalankan sekali)
         */
        function setupChart() {
            const ctx = document.getElementById('powerTrendChart').getContext('2d');
            myPowerChart = new Chart(ctx, {
                type: 'line', // Tipe chart
                data: {
                    labels: [], // Label waktu (sumbu X)
                    datasets: [
                        {
                            label: 'Active Power (W)',
                            data: [], // Data nilai (sumbu Y)
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            tension: 0.2,
                            fill: true
                        },
                        {
                            label: 'Reactive Power (VAR)',
                            data: [], // Data nilai (sumbu Y)
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            tension: 0.2,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true // Mulai sumbu Y dari 0
                        }
                    },
                    animation: {
                        duration: 400 // Animasi update
                    }
                }
            });
        }

        /**
         * Fungsi untuk mengupdate semua data di dashboard
         */
        function updateDashboard() {
            // Helper function untuk angka acak
            function rand(min, max, decimals = 2) {
                return (Math.random() * (max - min) + min).toFixed(decimals);
            }

            // --- Update Nilai Angka (Sama seperti sebelumnya) ---
            document.getElementById('total-ea').textContent = rand(10000, 15000);
            document.getElementById('total-er').textContent = rand(5000, 7000);
            document.getElementById('partial-active').textContent = rand(10, 100);
            document.getElementById('partial-reactive').textContent = rand(5, 50);
            document.getElementById('voltage').textContent = rand(218, 225, 1);
            document.getElementById('current').textContent = rand(1, 15, 2);
            document.getElementById('power-s').textContent = rand(2, 4, 2);
            document.getElementById('pf').textContent = rand(0.85, 0.99, 2);
            document.getElementById('freq').textContent = rand(49.8, 50.2, 1);
            
            // Waktu operasi
            if (!window.opDays) { 
                window.opDays = 120;
                window.opHrs = 5;
            }
            window.opHrs = (window.opHrs + 0.00083).toFixed(1); 
            if (window.opHrs >= 24) {
                window.opHrs = 0;
                window.opDays += 1;
            }
            document.getElementById('op-days').textContent = window.opDays;
            document.getElementById('op-hrs').textContent = window.opHrs;

            // --- Ambil data baru untuk Chart ---
            const newActivePower = rand(1500, 3000, 0);
            const newReactivePower = rand(300, 800, 0);

            // Update juga kartu P dan Q
            document.getElementById('power-p').textContent = newActivePower;
            document.getElementById('power-q').textContent = newReactivePower;

            // --- Update Chart ---
            if (myPowerChart) {
                // Buat label waktu baru
                const timeLabel = new Date().toLocaleTimeString('id-ID', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });

                // Tambahkan data baru ke chart
                myPowerChart.data.labels.push(timeLabel);
                myPowerChart.data.datasets[0].data.push(newActivePower);
                myPowerChart.data.datasets[1].data.push(newReactivePower);

                // Batasi jumlah data di chart agar tidak berat
                if (myPowerChart.data.labels.length > MAX_DATA_POINTS) {
                    myPowerChart.data.labels.shift(); // Hapus data tertua
                    myPowerChart.data.datasets[0].data.shift();
                    myPowerChart.data.datasets[1].data.shift();
                }

                // Perbarui (gambar ulang) chart
                myPowerChart.update();
            }
        }

        // --- Event Listeners ---

        // Saat halaman selesai dimuat
        document.addEventListener('DOMContentLoaded', () => {
            setupChart(); // 1. Inisialisasi chart
            updateDashboard(); // 2. Isi data pertama kali
        });

        // Atur interval untuk update data setiap 3000ms (3 detik)
        setInterval(updateDashboard, 3000);
    </script>

</body>
</html>

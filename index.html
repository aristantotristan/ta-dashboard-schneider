<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Monitoring Energi</title>
    
    <script src="https://cdn.jsdelivr.net/npm/gaugejs@1.3.6/dist/gauge.min.js"></script>

    <style>
        /* CSS Utama */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #1a237e;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .card {
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }
        .card h3 {
            margin-top: 0;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            color: #004d40;
        }
        
        /* Kartu Teks Biasa (Data Point) */
        .data-point { margin-bottom: 15px; }
        .data-point label { display: block; font-size: 0.95em; color: #555; margin-bottom: 5px; }
        .data-point .value { font-size: 2.3em; font-weight: 600; color: #0d47a1; }
        .data-point .unit { font-size: 1.1em; color: #444; margin-left: 8px; }

        /* 2. CSS UNTUK KARTU GAUGE */
        .card.gauge-card h3 {
             text-align: center; /* Pusatkan judul kartu gauge */
        }
        .card.gauge-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
        }
        .gauge-container {
            width: 100%;
            height: 150px; /* Beri tinggi agar konsisten */
            position: relative; 
            display: flex;
            justify-content: center;
        }
        .gauge-value {
            font-size: 2.2em;
            font-weight: 600;
            color: #333;
            margin-top: -30px; /* Tarik teks nilai sedikit ke atas */
            text-align: center;
        }
        .gauge-value .unit {
            font-size: 0.7em;
            font-weight: normal;
            color: #555;
            margin-left: 5px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Dashboard Monitoring Energi Schneider âš¡</h1>
        
        <div class="dashboard-grid">

            <div class="card gauge-card">
                <h3>Tegangan</h3>
                <div class="gauge-container">
                    <canvas id="gauge-voltage"></canvas>
                </div>
                <div class="gauge-value">
                    <span id="voltage-value">0.0</span><span class="unit">V</span>
                </div>
            </div>

            <div class="card gauge-card">
                <h3>Arus</h3>
                <div class="gauge-container">
                    <canvas id="gauge-current"></canvas>
                </div>
                <div class="gauge-value">
                    <span id="current-value">0.00</span><span class="unit">A</span>
                </div>
            </div>

            <div class="card gauge-card">
                <h3>Active Power (P)</h3>
                <div class="gauge-container">
                    <canvas id="gauge-power-p"></canvas>
                </div>
                <div class="gauge-value">
                    <span id="power-p-value">0</span><span class="unit">W</span>
                </div>
            </div>

            <div class="card gauge-card">
                <h3>Reactive Power (Q)</h3>
                <div class="gauge-container">
                    <canvas id="gauge-power-q"></canvas>
                </div>
                <div class="gauge-value">
                    <span id="power-q-value">0</span><span class="unit">VAR</span>
                </div>
            </div>

            <div class="card gauge-card">
                <h3>Apparent Power (S)</h3>
                <div class="gauge-container">
                    <canvas id="gauge-power-s"></canvas>
                </div>
                <div class="gauge-value">
                    <span id="power-s-value">0.00</span><span class="unit">kVA</span>
                </div>
            </div>
            
            <div class="card gauge-card">
                <h3>Power Factor (PF)</h3>
                <div class="gauge-container">
                    <canvas id="gauge-pf"></canvas>
                </div>
                <div class="gauge-value">
                    <span id="pf-value">0.00</span><span class="unit"></span>
                </div>
            </div>

            <div class="card gauge-card">
                <h3>Frekuensi (F)</h3>
                <div class="gauge-container">
                    <canvas id="gauge-freq"></canvas>
                </div>
                <div class="gauge-value">
                    <span id="freq-value">0.0</span><span class="unit">Hz</span>
                </div>
            </div>

            <div class="card">
                <h3>Total Energi</h3>
                <div class="data-point">
                    <label>Total EA Import (Active)</label>
                    <div>
                        <span class="value" id="total-ea">0.00</span>
                        <span class="unit">kWh</span>
                    </div>
                </div>
                <div class="data-point">
                    <label>Total ER Import (Reactive)</label>
                    <div>
                        <span class="value" id="total-er">0.00</span>
                        <span class="unit">kVARh</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Energi Parsial</h3>
                <div class="data-point">
                    <label>Partial Active E</label>
                    <div>
                        <span class="value" id="partial-active">0.00</span>
                        <span class="unit">kWh</span>
                    </div>
                </div>
                <div class="data-point">
                    <label>Partial Reactive E</label>
                    <div>
                        <span class="value" id="partial-reactive">0.00</span>
                        <span class="unit">kVARh</span>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>Waktu Operasi</h3>
                <div class="data-point">
                    <label>Hari</label>
                    <div>
                        <span class="value" id="op-days">0</span>
                        <span class="unit">Days</span>
                    </div>
                </div>
                <div class="data-point">
                    <label>Jam</label>
                    <div>
                        <span class="value" id="op-hrs">0</span>
                        <span class="unit">Hrs</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Tariffs</h3>
                <div class="data-point">
                    <label>Status</label>
                    <div>
                        <span class="value" id="tariffs">-</span>
                        <span class="unit"></span>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // 4. JAVASCRIPT UNTUK SETUP GAUGE
        
        // --- Variabel Global ---
        // Variabel untuk menyimpan instance Gauge
        let gaugeV, gaugeA, gaugeP, gaugeQ, gaugeS, gaugePF, gaugeF;

        // Opsi default untuk semua gauge
        const gaugeOptions = {
            angle: 0.15, // Sudut lengkungan gauge
            lineWidth: 0.3, // Lebar garis
            radiusScale: 0.9, // Seberapa besar gauge mengisi container
            pointer: {
                length: 0.5, // Panjang jarum
                strokeWidth: 0.035,
                color: '#000000'
            },
            limitMax: false, // Jangan batasi nilai
            limitMin: false,
            colorStart: '#6FADCF', // Warna gradien
            colorStop: '#8FC0DA',
            strokeColor: '#E0E0E0', // Warna latar belakang
            generateGradient: true,
            highDpiSupport: true
        };

        /**
         * Fungsi untuk inisialisasi SEMUA gauge
         */
        function setupGauges() {
            // Gauge Tegangan (V)
            const targetV = document.getElementById('gauge-voltage');
            const optsV = { ...gaugeOptions, staticLabels: { font: "12px sans-serif", labels: [180, 200, 220, 240, 260], color: "#000" } };
            gaugeV = new Gauge(targetV).setOptions(optsV);
            gaugeV.maxValue = 260; 
            gaugeV.setMinValue(180); 
            gaugeV.animationSpeed = 32; 

            // Gauge Arus (A)
            const targetA = document.getElementById('gauge-current');
            const optsA = { ...gaugeOptions, staticLabels: { font: "12px sans-serif", labels: [0, 5, 10, 15, 20], color: "#000" } };
            gaugeA = new Gauge(targetA).setOptions(optsA);
            gaugeA.maxValue = 20;
            gaugeA.setMinValue(0);
            gaugeA.animationSpeed = 32; 

            // Gauge Active Power (P)
            const targetP = document.getElementById('gauge-power-p');
            const optsP = { ...gaugeOptions, staticLabels: { font: "12px sans-serif", labels: [0, 1000, 2000, 3000, 4000, 5000], color: "#000" } };
            gaugeP = new Gauge(targetP).setOptions(optsP);
            gaugeP.maxValue = 5000;
            gaugeP.setMinValue(0);
            gaugeP.animationSpeed = 32; 

            // Gauge Reactive Power (Q)
            const targetQ = document.getElementById('gauge-power-q');
            const optsQ = { ...gaugeOptions, staticLabels: { font: "12px sans-serif", labels: [0, 250, 500, 750, 1000], color: "#000" } };
            gaugeQ = new Gauge(targetQ).setOptions(optsQ);
            gaugeQ.maxValue = 1000;
            gaugeQ.setMinValue(0);
            gaugeQ.animationSpeed = 32; 

            // Gauge Apparent Power (S)
            const targetS = document.getElementById('gauge-power-s');
            const optsS = { ...gaugeOptions, staticLabels: { font: "12px sans-serif", labels: [0, 1, 2, 3, 4, 5], color: "#000" } };
            gaugeS = new Gauge(targetS).setOptions(optsS);
            gaugeS.maxValue = 5; // kVA
            gaugeS.setMinValue(0);
            gaugeS.animationSpeed = 32; 

            // Gauge Power Factor (PF)
            const targetPF = document.getElementById('gauge-pf');
            const optsPF = { ...gaugeOptions, staticLabels: { font: "12px sans-serif", labels: [0.5, 0.75, 1], color: "#000" } };
            gaugePF = new Gauge(targetPF).setOptions(optsPF);
            gaugePF.maxValue = 1;
            gaugePF.setMinValue(0.5);
            gaugePF.animationSpeed = 32; 

            // Gauge Frequency (F)
            const targetF = document.getElementById('gauge-freq');
            const optsF = { ...gaugeOptions, staticLabels: { font: "12px sans-serif", labels: [48, 49, 50, 51, 52], color: "#000" } };
            gaugeF = new Gauge(targetF).setOptions(optsF);
            gaugeF.maxValue = 52;
            gaugeF.setMinValue(48);
            gaugeF.animationSpeed = 32;
        }

        /**
         * Fungsi untuk mengupdate semua data di dashboard
         */
        function updateDashboard() {
            // Helper function untuk angka acak (data dummy)
            function rand(min, max, decimals = 2) {
                return (Math.random() * (max - min) + min).toFixed(decimals);
            }

            // --- Update Nilai Teks (Total & Parsial) ---
            document.getElementById('total-ea').textContent = rand(10000, 15000);
            document.getElementById('total-er').textContent = rand(5000, 7000);
            document.getElementById('partial-active').textContent = rand(10, 100);
            document.getElementById('partial-reactive').textContent = rand(5, 50);
            
            if (!window.opDays) { window.opDays = 120; window.opHrs = 5; }
            window.opHrs = (window.opHrs + 0.00083).toFixed(1); 
            if (window.opHrs >= 24) { window.opHrs = 0; window.opDays += 1; }
            document.getElementById('op-days').textContent = window.opDays;
            document.getElementById('op-hrs').textContent = window.opHrs;


            // --- Ambil data DUMMY baru untuk GAUGE ---
            const newVoltage = rand(218, 225, 1);
            const newCurrent = rand(1, 15, 2);
            const newActivePower = rand(1500, 3000, 0);
            const newReactivePower = rand(300, 800, 0);
            const newApparentPower = rand(2, 4, 2);
            const newPF = rand(0.85, 0.99, 2);
            const newFreq = rand(49.8, 50.2, 1);

            // --- 5. UPDATE SEMUA GAUGE & TEKSNYA ---
            if (gaugeV) {
                gaugeV.set(newVoltage);
                document.getElementById('voltage-value').textContent = newVoltage;
            }
            if (gaugeA) {
                gaugeA.set(newCurrent);
                document.getElementById('current-value').textContent = newCurrent;
            }
            if (gaugeP) {
                gaugeP.set(newActivePower);
                document.getElementById('power-p-value').textContent = newActivePower;
            }
            if (gaugeQ) {
                gaugeQ.set(newReactivePower);
                document.getElementById('power-q-value').textContent = newReactivePower;
            }
            if (gaugeS) {
                gaugeS.set(newApparentPower);
                document.getElementById('power-s-value').textContent = newApparentPower;
            }
            if (gaugePF) {
                gaugePF.set(newPF);
                document.getElementById('pf-value').textContent = newPF;
            }
            if (gaugeF) {
                gaugeF.set(newFreq);
                document.getElementById('freq-value').textContent = newFreq;
            }
        }

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            setupGauges();    // 1. Inisialisasi semua gauge
            updateDashboard(); // 2. Isi data pertama kali
        });

        // Atur interval untuk update data setiap 3000ms (3 detik)
        setInterval(updateDashboard, 3000);
    </script>

</body>
</html>

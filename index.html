<!DOCTYPE html>
<html>
<head>
<title>Power Meter Dashboard</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<style>
body{background:#111;color:#fff;font-family:Arial}
.list button{width:100%;padding:10px;margin:4px;background:#222;color:#fff;border:1px solid #444}
.active{background:#00aa66}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #444;padding:6px}
th{background:#222}
</style>
</head>
<body>

<h2>⚡ Power Meter (1–18)</h2>

<div style="display:flex">
  <div class="list" style="width:20%">
    <script>
      for(let i=1;i<=18;i++)
        document.write(`<button onclick="select(${i})" id="btn${i}">Mesin ${i}</button>`)
    </script>
  </div>

  <div style="width:80%;padding-left:10px">
    <h3 id="title">Pilih Mesin</h3>
    <table>
      <tbody id="detail"></tbody>
    </table>
  </div>
</div>

<script>
let active=1;
const dataStore={};

function select(id){
  active=id;
  document.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
  document.getElementById("btn"+id).classList.add("active");
  render();
}

function render(){
  const d=dataStore[active];
  if(!d) return;
  document.getElementById("title").innerText="Mesin "+active+" ("+d.status+")";
  const keys=["EaT","ErT","EaP","ErP","V","I1","I2","I3","P","Q","S","PF","Hz","OpH"];
  detail.innerHTML="";
  keys.forEach(k=>{
    detail.innerHTML+=`<tr><th>${k}</th><td>${d[k]??"-"}</td></tr>`;
  });
}

const client=mqtt.connect(
 "wss://3367c11cb6104f8ea02e99014f2015ba.s1.eu.hivemq.cloud:8884/mqtt",
 {username:"web_dashboard",password:"Tristan12"}
);

client.on("message",(_,m)=>{
 const d=JSON.parse(m);
 dataStore[d.id]=d;
 if(d.id===active) render();
});

client.on("connect",()=>client.subscribe("politeknik/meter/data"));
</script>

</body>
</html>

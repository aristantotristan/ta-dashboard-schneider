<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Maintenance Sistem</title>

<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        background: #0f0f0f;
        color: #e5e5e5;
        padding: 20px;
    }

    h1 {
        text-align: center;
        color: #00ffc2;
        margin-bottom: 20px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        background: #1a1a1a;
        border-radius: 10px;
        overflow: hidden;
    }

    th, td {
        padding: 12px;
        border-bottom: 1px solid #333;
        font-size: 14px;
    }

    th {
        background: #00ffc2;
        color: #000;
        font-weight: bold;
    }

    tr:hover {
        background: #222;
    }

    .status-normal { color: #00ff99; font-weight: bold; }
    .status-warning { color: #ffcc00; font-weight: bold; }
    .status-error { color: #ff4444; font-weight: bold; }
</style>
</head>

<body>

<h1>Maintenance Sistem</h1>

<table>
    <thead>
        <tr>
            <th>Device</th>
            <th>Event</th>
            <th>Status</th>
            <th>Waktu</th>
            <th>Note</th>
        </tr>
    </thead>
    <tbody id="tableBody">
        <tr><td colspan="5" style="text-align:center; padding:20px;">Loading...</td></tr>
    </tbody>
</table>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabaseUrl = "https://rojhcadtqfynlqzubftx.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJvamhjYWR0cWZ5bmxxenViZnR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMzYzNTksImV4cCI6MjA3NzcxMjM1OX0.XZElBWD-QdS8XVKex92VKUAlifC6BXqe3kGYPmZ1Mcs";

const db = createClient(supabaseUrl, supabaseKey);

async function loadData() {
    const tableBody = document.getElementById("tableBody");
    tableBody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding:20px;">Loading...</td></tr>`;

    const { data, error } = await db
        .from("watchdog_log")
        .select("*")
        .order("detected_at", { ascending: false });

    if (error) {
        tableBody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding:20px; color:red;">Error load data</td></tr>`;
        console.error(error);
        return;
    }

    tableBody.innerHTML = "";

    data.forEach(row => {
        const tr = document.createElement("tr");

        let statusClass =
            row.status === "normal" ? "status-normal" :
            row.status === "warning" ? "status-warning" :
            "status-error";

        tr.innerHTML = `
            <td>${row.device_id}</td>
            <td>${row.event}</td>
            <td class="${statusClass}">${row.status.toUpperCase()}</td>
            <td>${new Date(row.detected_at).toLocaleString()}</td>
            <td>${row.note ?? "-"}</td>
        `;

        tableBody.appendChild(tr);
    });
}

// refresh per 5 detik
loadData();
setInterval(loadData, 5000);
</script>

</body>
</html>

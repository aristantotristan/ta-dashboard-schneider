<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Maintenance Log</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial; padding: 20px; background: #111; color: #fff; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px; border-bottom: 1px solid #333; text-align: left; }
        th { background: #222; }
    </style>
</head>
<body>

<h2>Watchdog Log</h2>

<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Device</th>
            <th>Status</th>
            <th>Detected At</th>
            <th>Note</th>
        </tr>
    </thead>
    <tbody id="log-body"></tbody>
</table>

<script>
    const SUPABASE_URL = "https://rojhcadtqfynlqzubftx.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJvamhjYWR0cWZ5bmxxenViZnR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMzYzNTksImV4cCI6MjA3NzcxMjM1OX0.XZElBWD-QdS8XVKex92VKUAlifC6BXqe3kGYPmZ1Mcs";

    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function loadLogs() {
        const { data, error } = await supabase
            .from("watchdog_log")
            .select("*")
            .order("detected_at", { ascending: false })
            .limit(200);

        if (error) {
            console.error("Error loading logs:", error);
            document.getElementById("log-body").innerHTML =
                `<tr><td colspan="5">Error loading data!</td></tr>`;
            return;
        }

        const tbody = document.getElementById("log-body");
        tbody.innerHTML = "";

        data.forEach(row => {
            const tr = document.createElement("tr");

            tr.innerHTML = `
                <td>${row.id}</td>
                <td>${row.device_id || "-"}</td>
                <td>${row.status}</td>
                <td>${new Date(row.detected_at).toLocaleString()}</td>
                <td>${row.note || "-"}</td>
            `;

            tbody.appendChild(tr);
        });
    }

    loadLogs();
    setInterval(loadLogs, 5000); // refresh tiap 5 detik
</script>

</body>
</html>
